<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binjas Perkasa - Simulasi CAT SKD 2025</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        // Konfigurasi MathJax
        MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['\\[', '\\]']],
                processEscapes: true,
                packages: {'[+]': ['ams', 'color']}
            },
            options: {
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            startup: {
                typeset: false // Nonaktifkan render otomatis saat memuat
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" id="MathJax-script"></script>

    <style>
        /* Global & Reset */
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #f0f4f8, #d9e2ec);
            color: #333;
        }

        .container {
            background-color: #ffffff;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            width: 95%;
            max-width: 1200px;
            margin: 30px auto;
            padding: 30px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
        }

        h1, h2, h3 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 25px;
            font-weight: 600;
        }

        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s ease;
            margin: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        button:hover { background-color: #0056b3; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        button:disabled { background-color: #cccccc; cursor: not-allowed; box-shadow: none; transform: translateY(0); }

        /* Navbar */
        .navbar {
            background-color: #ffffff;
            padding: 1rem 2rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            flex-wrap: wrap; 
        }
        .nav-brand {
            font-size: 1.5rem;
            font-weight: 700;
            color: #007bff;
            text-decoration: none;
            transition: color 0.3s;
        }
        .nav-links {
            display: flex;
            gap: 1.5rem;
        }
        .nav-links a { font-weight: 500; color: #4a5568; text-decoration: none; transition: color 0.3s; }
        .nav-links a:hover { color: #0056b3; }

        /* Splash Screen */
        #splash-screen { text-align: center; padding: 20px 0; max-width: 800px; width:100%; }
        #splash-screen p, #splash-screen ul { font-size: 1em; line-height: 1.7; margin-bottom: 20px; color: #555; text-align: left; }
        #splash-screen ul { list-style-position: inside; padding-left: 0; }
        #splash-screen li { margin-bottom: 8px; }

        .name-input-section { margin-top: 20px; margin-bottom: 30px; padding: 20px; border: 1px solid #e0e0e0; border-radius: 10px; background-color: #f9fbfd; }
        .name-input-section label { display: block; margin-bottom: 10px; font-weight: 600; color: #34495e; }
        .name-input-section input[type="text"] { width: 100%; box-sizing: border-box; padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 1em; }

        .file-upload-section { margin-top: 30px; padding: 20px; border: 1px solid #e0e0e0; border-radius: 10px; background-color: #f9fbfd; max-width: 600px; }
        .file-upload-section h3 { margin-bottom: 15px; color: #34495e; }
        
        #csv-load-status { margin-top: 10px; font-size: 0.9em; font-weight: 500; line-height: 1.4; }
        #csv-load-status.error { color: #dc3545; }
        #csv-load-status.warning { color: #ffc107; }
        #csv-load-status.success { color: #28a745; }
        
        /* Exam Container */
        #exam-container { display: none; width: 100%; flex-direction: row; gap: 25px; min-height: 600px; }
        .main-exam-area { flex: 3; display: flex; flex-direction: column; min-width: 0;}
        .exam-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid #e0e0e0; width: 100%; flex-wrap: wrap; gap: 1rem;}
        .timer-display { font-size: 1.4em; font-weight: 700; color: #e74c3c; background-color: #ffebe9; padding: 8px 15px; border-radius: 8px; }
        .question-counter { font-size: 1.1em; font-weight: 600; color: #3498db; }
        .question-area { background-color: #fcfcfc; border: 1px solid #e9e9e9; border-radius: 12px; padding: 25px; margin-bottom: 25px; flex-grow: 1; }
        .question-text { font-size: 1.1em; font-weight: 600; line-height: 1.7; color: #444; word-wrap: break-word; }
        .options-container { display: flex; flex-direction: column; gap: 12px; margin-top: 20px; }
        .options-container label { display: flex; align-items: flex-start; cursor: pointer; font-size: 1em; padding: 14px 18px; border: 1px solid #e0e0e0; border-radius: 10px; transition: background-color 0.25s ease; background-color: #fff; }
        .options-container input[type="radio"] { margin-right: 15px; margin-top: 5px; flex-shrink: 0; }
        .exam-footer { display: flex; flex-direction: column; align-items: stretch; gap: 0.5rem; width: 100%; margin-top: 25px; padding-top: 15px; border-top: 1px solid #e0e0e0; }
        .nav-buttons { display: flex; gap: 10px; }
        .nav-buttons button, .doubt-button, .finish-button { width: 100%; margin: 0; }
        .finish-button { background-color: #dc3545; }

        /* Question Palette Sidebar */
        .question-palette-sidebar { flex: 1; background-color: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 12px; padding: 20px; box-sizing: border-box; align-self: flex-start; max-height: 70vh; overflow-y: auto; position: sticky; top: 100px; }
        .palette-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(45px, 1fr)); gap: 8px; }
        .palette-item { width: 100%; padding-top: 100%; position: relative; background-color: #e9ecef; border-radius: 8px; cursor: pointer; transition: all 0.2s ease; }
        .palette-item > span { position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; justify-content: center; align-items: center; font-size: 0.9em; font-weight: 500; }
        .palette-item.active { background-color: #007bff; color: white; transform: scale(1.05); }
        .palette-item.answered { background-color: #28a745; color: white; }
        .palette-item.doubt { background-color: #ffc107; color: #333; }
        
        /* Result Screen */
        #result-screen { display: none; text-align: center; width:100%; }
        .table-wrapper { overflow-x: auto; width:100%; }
        #result-screen table { width: 100%; border-collapse: collapse; min-width: 500px; }
        #result-screen th, #result-screen td { border: 1px solid #eee; padding: 12px 15px; }
        #result-screen th { background-color: #f5f7fa; font-weight: 600; text-transform: uppercase; font-size: 0.85em; }
        #result-screen .status-pass { color: #28a745; font-weight: bold; }
        #result-screen .status-fail { color: #dc3545; font-weight: bold; }
        #result-screen .overall-status { font-size: 1.4em; font-weight: bold; margin-top: 30px; padding: 15px; border-radius: 10px; }
        #result-screen .overall-status.pass { background-color: #e6ffe6; color: #1a7e3d; }
        #result-screen .overall-status.fail { background-color: #ffe6e6; color: #b3243a; }
        
        /* Mobile Responsive Adjustments */
        @media (max-width: 992px) {
            #exam-container { flex-direction: column; }
            .question-palette-sidebar { position: static; max-height: unset; margin-top: 25px; top: unset; width: 100%; box-sizing: border-box;}
        }

        @media (max-width: 768px) {
            .container { padding: 15px; margin-top: 15px; margin-bottom: 15px; }
            h1 { font-size: 1.8rem; } h2 { font-size: 1.5rem; }
            .navbar { padding: 1rem; }
            .nav-container { flex-direction: column; align-items: flex-start; gap: 0.5rem; }
            .nav-brand { font-size: 1.3rem; }
            .nav-links { gap: 1rem; padding-top: 0.5rem; width: 100%; justify-content: space-between; }
            .nav-links a { margin-left: 0; }
            .exam-footer { flex-direction: column; }
            #result-screen h2 { font-size: 1.6em; }
            #result-screen .overall-status { font-size: 1.2em; }
        }

        @media (min-width: 769px) {
            .exam-footer { flex-direction: row; justify-content: space-between; }
            .nav-buttons { flex-basis: auto; width: auto; flex-grow: 0; }
            .doubt-button, .finish-button { width: auto; }
        }

    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-brand">Pusat Aplikasi Perkasa</a>
            <div class="nav-links">
                <a href="Tes Psikologi Kecermatan Perkasa.html">Tes Kecermatan</a>
                <a href="Kalkulator Jasmani Perkasa.html">Kalkulator Jasmani</a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <!-- Splash Screen -->
        <div id="splash-screen">
            <h1>Binjas Perkasa - Simulasi CAT SKD 2025</h1>
            <p>Selamat datang di aplikasi simulasi Computer Assisted Test (CAT) untuk Seleksi Kompetensi Dasar (SKD). Aplikasi ini dirancang untuk membantu Anda berlatih dan memahami format ujian TWK, TIU, dan TKP sesuai standar terbaru.</p>
            
            <div class="name-input-section">
                <label for="user-name-input">Masukkan Nama Anda:</label>
                <input type="text" id="user-name-input" placeholder="Contoh: Budi Santoso" required>
            </div>

            <div class="file-upload-section">
                <h3>Status Pemuatan Soal</h3>
                <p id="csv-load-status">Memuat soal secara otomatis...</p>
            </div>

            <p><strong>Peraturan Ujian:</strong></p>
            <ul>
                <li>Total Soal: 110 (TWK 30, TIU 35, TKP 45)</li>
                <li>Waktu Ujian: 100 menit</li>
                <li><strong>Penilaian:</strong> TWK & TIU (Benar +5), TKP (Skor 1-5).</li>
                <li><strong>Passing Grade:</strong> TWK: 65, TIU: 80, TKP: 166</li>
            </ul>
            <button id="start-button" disabled>Mulai Ujian</button>
        </div>

        <!-- Exam Container -->
        <div id="exam-container">
            <div class="main-exam-area">
                <div class="exam-header">
                    <div class="timer-display" id="timer-display">Waktu: 00:00:00</div>
                    <div class="question-counter" id="question-counter">Soal 0 dari 0</div>
                </div>
                <div class="question-area">
                    <div id="question-media"></div>
                    <div class="question-text" id="question-text"></div>
                    <div class="options-container" id="options-container"></div>
                </div>
                <div class="exam-footer">
                    <div class="nav-buttons">
                        <button id="prev-button" disabled><< Sebelumnya</button>
                        <button id="next-button">Selanjutnya >></button>
                    </div>
                    <button id="doubt-button" class="doubt-button">Ragu-ragu</button>
                    <button id="finish-button" class="finish-button">Selesai Ujian</button>
                </div>
            </div>

            <div class="question-palette-sidebar">
                <h3>Panel Soal</h3>
                <div class="palette-grid" id="palette-grid"></div>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen">
            <h2>Hasil Ujian SKD Anda</h2>
            <h3 class="user-info" id="result-user-name"></h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Kategori Tes</th>
                            <th>Skor</th>
                            <th>Skor Maksimal</th>
                            <th>Passing Grade</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>TWK</td><td id="score-twk"></td><td id="max-twk"></td><td id="pg-twk"></td><td id="status-twk"></td></tr>
                        <tr><td>TIU</td><td id="score-tiu"></td><td id="max-tiu"></td><td id="pg-tiu"></td><td id="status-tiu"></td></tr>
                        <tr><td>TKP</td><td id="score-tkp"></td><td id="max-tkp"></td><td id="pg-tkp"></td><td id="status-tkp"></td></tr>
                    </tbody>
                </table>
            </div>
            <h3 class="overall-status" id="overall-status"></h3>
            <button id="download-pdf-button">Unduh Hasil (PDF)</button>
            <button onclick="location.reload()">Ulangi Ujian</button>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script>
        // --- Global Variables ---
        let allQuestions = [];
        let shuffledQuestions = [];
        let currentQuestionIndex = 0;
        let userAnswers = {};
        let timerSeconds = 100 * 60;
        let timerInterval;
        let examRunning = false;
        let userName = '';

        const passingGrades = { TWK: 65, TIU: 80, TKP: 166 };
        const questionCounts = { TWK: 0, TIU: 0, TKP: 0 };
        const REQUIRED_TWK = 30;
        const REQUIRED_TIU = 35;
        const REQUIRED_TKP = 45;

        // --- DOM Elements ---
        const splashScreen = document.getElementById('splash-screen');
        const examContainer = document.getElementById('exam-container');
        const resultScreen = document.getElementById('result-screen');
        const startButton = document.getElementById('start-button');
        const timerDisplay = document.getElementById('timer-display');
        const questionCounter = document.getElementById('question-counter');
        const questionMedia = document.getElementById('question-media');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const prevButton = document.getElementById('prev-button');
        const nextButton = document.getElementById('next-button');
        const doubtButton = document.getElementById('doubt-button');
        const finishButton = document.getElementById('finish-button');
        const paletteGrid = document.getElementById('palette-grid');
        const csvLoadStatus = document.getElementById('csv-load-status');
        const userNameInput = document.getElementById('user-name-input');
        const resultUserNameDisplay = document.getElementById('result-user-name');
        const downloadPdfButton = document.getElementById('download-pdf-button');

        // --- Helper Functions ---
        function formatTime(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;
            return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
        }

        // --- CSV Parsing Function ---
        function parseCSV(text) {
            const lines = text.split(/\r?\n/).filter(line => line.trim() !== '');
            const questions = [];
            
            for (let index = 1; index < lines.length; index++) { // Start from 1 to skip header
                const line = lines[index];
                const values = [];
                let currentVal = "", inQuote = false;
                for (const char of line) {
                    if (char === '"' && (line[line.indexOf(char)-1] !== '\\')) { 
                        inQuote = !inQuote; 
                    } else if (char === ',' && !inQuote) { 
                        values.push(currentVal.trim()); 
                        currentVal = ""; 
                    } else { 
                        currentVal += char; 
                    }
                }
                values.push(currentVal.trim());
                if (values.length < 9) continue;
                
                const processedValues = values.map(val => val.replace(/^"|"$/g, '').replace(/\\"/g, '"'));

                const question = {
                    id: processedValues[0],
                    type: processedValues[1].toUpperCase(),
                    question: processedValues[2],
                    options: {}
                };

                const optionLetters = ['A', 'B', 'C', 'D', 'E'];
                optionLetters.forEach((key, i) => { question.options[key] = processedValues[i + 3] || ''; });

                if (question.type === 'TKP') {
                    optionLetters.forEach((key, i) => {
                        const score = parseInt(processedValues[i + 8]);
                        question.options[key] = { text: question.options[key], score: isNaN(score) ? 0 : score };
                    });
                } else {
                    question.correctAnswer = processedValues[8];
                }
                if (processedValues[13] && processedValues[14]) {
                    question.mediaUrl = processedValues[13];
                    question.mediaType = processedValues[14];
                }
                questions.push(question);
            }
            return questions;
        }


        // --- Exam Functions ---
        function startExam() {
            userName = userNameInput.value.trim();
            if (!userName) { alert('Mohon masukkan nama Anda.'); return; }
            if (allQuestions.length === 0) { alert("Soal belum termuat. Mohon tunggu atau muat ulang halaman."); return; }

            const twkQuestions = allQuestions.filter(q => q.type === 'TWK').slice(0, REQUIRED_TWK);
            const tiuQuestions = allQuestions.filter(q => q.type === 'TIU').slice(0, REQUIRED_TIU);
            const tkpQuestions = allQuestions.filter(q => q.type === 'TKP').slice(0, REQUIRED_TKP);

            questionCounts.TWK = twkQuestions.length;
            questionCounts.TIU = tiuQuestions.length;
            questionCounts.TKP = tkpQuestions.length;
            
            shuffledQuestions = [...twkQuestions, ...tiuQuestions, ...tkpQuestions];
            if (shuffledQuestions.length === 0) { alert("Tidak ada soal yang valid."); return; }

            splashScreen.style.display = 'none';
            examContainer.style.display = 'flex';
            examRunning = true;
            
            renderQuestionPalette();
            loadQuestion(0);
            startTimer();
        }

        function startTimer() { timerInterval = setInterval(updateTimer, 1000); }
        function updateTimer() {
            timerDisplay.textContent = `Waktu: ${formatTime(timerSeconds)}`;
            if (timerSeconds-- <= 0) endExam('Waktu ujian habis!');
        }

        function saveAnswer() {
            const currentQuestion = shuffledQuestions[currentQuestionIndex];
            if (!currentQuestion) return;
            const selectedOption = optionsContainer.querySelector('input[name="option"]:checked');
            const currentState = userAnswers[currentQuestion.id] || { selected: null, isDoubt: false };
            userAnswers[currentQuestion.id] = { selected: selectedOption ? selectedOption.value : null, isDoubt: currentState.isDoubt };
            updatePaletteStatus(currentQuestionIndex);
        }

        function toggleDoubt() {
            const currentQuestion = shuffledQuestions[currentQuestionIndex];
            if (!currentQuestion) return;
            const currentState = userAnswers[currentQuestion.id] || { selected: null, isDoubt: false };
            currentState.isDoubt = !currentState.isDoubt;
            userAnswers[currentQuestion.id] = currentState;
            doubtButton.textContent = currentState.isDoubt ? 'Batalkan Ragu' : 'Ragu-ragu';
            updatePaletteStatus(currentQuestionIndex);
        }

        function loadQuestion(index) {
            saveAnswer();
            currentQuestionIndex = index;
            const q = shuffledQuestions[index];
            const answerState = userAnswers[q.id] || { selected: null, isDoubt: false };

            questionCounter.textContent = `Soal ${index + 1} dari ${shuffledQuestions.length} (${q.type})`;
            questionText.textContent = q.question;
            optionsContainer.innerHTML = '';
            
            Object.keys(q.options).forEach(key => {
                const optionData = q.options[key];
                const optionText = q.type === 'TKP' ? optionData.text : optionData;
                if (!optionText) return;

                const label = document.createElement('label');
                const input = document.createElement('input');
                input.type = 'radio';
                input.name = 'option';
                input.value = key;
                if (answerState.selected === key) input.checked = true;
                
                const span = document.createElement('span');
                span.textContent = `${key}. ${optionText}`;
                
                label.append(input, span);
                optionsContainer.appendChild(label);
            });

            prevButton.disabled = index === 0;
            nextButton.disabled = index === shuffledQuestions.length - 1;
            doubtButton.textContent = answerState.isDoubt ? 'Batalkan Ragu' : 'Ragu-ragu';
            updatePaletteActiveState();
            
            if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
                MathJax.typesetPromise([questionText, optionsContainer]).catch(err => console.error(err));
            }
        }
        
        function confirmFinish() {
            saveAnswer();
            if (confirm('Apakah Anda yakin ingin mengakhiri ujian?')) endExam();
        }

        function endExam(message = '') {
            if (message) alert(message);
            clearInterval(timerInterval);
            examRunning = false;
            examContainer.style.display = 'none';
            resultScreen.style.display = 'block';
            calculateAndDisplayResults();
        }

        function calculateAndDisplayResults() {
            let scores = { TWK: 0, TIU: 0, TKP: 0 };
            shuffledQuestions.forEach(q => {
                const answer = userAnswers[q.id]?.selected;
                if (!answer) return;
                if (q.type === 'TKP') scores.TKP += q.options[answer]?.score || 0;
                else if (answer === q.correctAnswer) scores[q.type] += 5;
            });

            const totalScore = scores.TWK + scores.TIU + scores.TKP;
            resultUserNameDisplay.textContent = `Nama Peserta: ${userName}`;

            let allPass = true;
            ['TWK', 'TIU', 'TKP'].forEach(type => {
                const score = scores[type];
                const pg = passingGrades[type];
                const status = score >= pg;
                if (!status) allPass = false;

                document.getElementById(`score-${type.toLowerCase()}`).textContent = score;
                document.getElementById(`max-${type.toLowerCase()}`).textContent = questionCounts[type] * 5;
                document.getElementById(`pg-${type.toLowerCase()}`).textContent = pg;
                const statusEl = document.getElementById(`status-${type.toLowerCase()}`);
                statusEl.textContent = status ? 'Lulus' : 'Gagal';
                statusEl.className = status ? 'status-pass' : 'status-fail';
            });
            
            const overallStatusEl = document.getElementById('overall-status');
            overallStatusEl.textContent = allPass 
                ? `SELAMAT! Anda LULUS SKD dengan Total Skor ${totalScore}!` 
                : `MAAF, Anda TIDAK LULUS SKD. Total Skor Anda ${totalScore}.`;
            overallStatusEl.className = `overall-status ${allPass ? 'pass' : 'fail'}`;
        }
        
        function renderQuestionPalette() {
            paletteGrid.innerHTML = shuffledQuestions.map((q, index) => 
                `<div class="palette-item" data-index="${index}"><span class="palette-content">${index + 1}</span></div>`
            ).join('');
            paletteGrid.querySelectorAll('.palette-item').forEach(item => {
                item.addEventListener('click', () => loadQuestion(parseInt(item.dataset.index)));
            });
            updatePaletteActiveState();
        }

        function updatePaletteStatus(index) {
            const item = paletteGrid.querySelector(`.palette-item[data-index="${index}"]`);
            if (!item) return;
            const q = shuffledQuestions[index];
            const answerState = userAnswers[q.id] || { isDoubt: false, selected: null };
            item.className = 'palette-item'; // Reset
            if (answerState.isDoubt) item.classList.add('doubt');
            else if (answerState.selected) item.classList.add('answered');
            if (index === currentQuestionIndex) item.classList.add('active');
        }

        function updatePaletteActiveState() {
            document.querySelectorAll('.palette-item').forEach(item => item.classList.remove('active'));
            const activeItem = paletteGrid.querySelector(`.palette-item[data-index="${currentQuestionIndex}"]`);
            if(activeItem) activeItem.classList.add('active');
        }
        
        function downloadPdfResult() {
            const element = document.getElementById('result-screen');
            html2pdf(element.cloneNode(true), {
                margin: 10,
                filename: `Hasil_SKD_${userName.replace(/\s/g, '_')}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            });
        }
        
        // --- Event Listeners ---
        startButton.addEventListener('click', startExam);
        prevButton.addEventListener('click', () => loadQuestion(currentQuestionIndex - 1));
        nextButton.addEventListener('click', () => loadQuestion(currentQuestionIndex + 1));
        doubtButton.addEventListener('click', toggleDoubt);
        finishButton.addEventListener('click', confirmFinish);
        downloadPdfButton.addEventListener('click', downloadPdfResult);
        
        window.onload = () => {
            startButton.disabled = true;
            userNameInput.focus();

            const csvUrl = 'https://raw.githubusercontent.com/maulana-hermawan/perkasa-center/main/skd001.csv';
            
            csvLoadStatus.textContent = 'Memuat soal dari server...';
            csvLoadStatus.className = 'warning';

            fetch(csvUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Gagal mengambil data dari server: ${response.status} ${response.statusText}`);
                    }
                    return response.text();
                })
                .then(csvText => {
                    try {
                        allQuestions = parseCSV(csvText);
                        if (allQuestions.length > 0) {
                            csvLoadStatus.textContent = `Berhasil memuat ${allQuestions.length} soal. Silakan masukkan nama dan mulai ujian.`;
                            csvLoadStatus.className = 'success';
                            startButton.disabled = false;
                        } else {
                            throw new Error("File CSV tidak berisi soal yang valid atau kosong.");
                        }
                    } catch (error) {
                        csvLoadStatus.textContent = `Gagal memproses data soal: ${error.message}`;
                        csvLoadStatus.className = 'error';
                    }
                })
                .catch(error => {
                    console.error('Error fetching CSV:', error);
                    csvLoadStatus.textContent = `Gagal memuat soal. Periksa koneksi internet Anda. (${error.message})`;
                    csvLoadStatus.className = 'error';
                });
        };

    </script>
</body>
</html>
